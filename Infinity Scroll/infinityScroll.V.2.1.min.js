/**
* Inifinity Scroll
* @author Carlos Vinicius
* @version 2.1
* @date 2011-03-06
*/
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
jQuery.fn.infinitScroll=function(m){var c=jQuery.extend({toTop:"#returnToTop",lastShelf:".prateleira:last",elemLoading:'<div id="scrollLoading">Carregando ... </div>',searchUrl:null,callback:function(){},getShelfHeight:function(){return b.scrollTop()+b.height()}},m),b=jQuery(this);jQuery("");var f="object"===typeof console;if(b.length<1)return b;var d=$(window),i=$(document),j=$("body"),e=j.find(c.toTop),k=jQuery(c.elemLoading),l=true;currentPage=2;var h={scrollToTop:function(){var a=d.height();d.bind("resize",
function(){a=d.height()});i.bind("scroll",function(){i.scrollTop()>a?e.stop(true).fadeTo(300,1,function(){e.show()}):e.stop(true).fadeTo(300,0,function(){e.hide()})});e.find("a").bind("click",function(){jQuery("html,body").animate({scrollTop:0},"slow");return false})},getSearchUrl:function(){var a,g,b;jQuery("script:not([src])").each(function(){g=jQuery(this)[0].innerHTML;b=/\/buscapagina\?.+&PageNumber=/i;if(g.search(/\/buscapagina\?/i)>-1){a=b.exec(g);return false}});if(typeof a!=="undefined"&&
typeof a[0]!=="undefined")return a[0];f&&console.log("[Erro] N\u00e3o foi poss\u00edvel localizar a url de busca da p\u00e1gina.\n Tente adicionar o .js ao final da p\u00e1gina. \n[M\u00e9todo: getSearchUrl]");return""},infinitScroll:function(){var a=j.find(".pager:first").attr("id")||"";pages=eval("pagecount_"+a.split("_").pop());searchUrl=null!==c.searchUrl?c.searchUrl:h.getSearchUrl();currentStatus=true;"undefined"===typeof pages&&console.log("[Erro] N\u00e3o foi poss\u00edvel localizar quantidade de p\u00e1ginas.\n Tente adicionar o .js ao final da p\u00e1gina. \n[M\u00e9todo: infinitScroll]");
d.bind("scroll",function(){if(currentPage<=pages&&l){if(d.scrollTop()+d.height()>=c.getShelfHeight()&&currentStatus){var a=b.find(c.lastShelf);if(a.length<1){f&&console.log("[Erro] \u00daltima Prateleira/Vitrine n\u00e3o encontrada \n ("+a.selector+")");return false}a.after(k);currentStatus=false;jQuery.ajax({url:searchUrl+currentPage,success:function(b){if(b.trim().length<1){l=false;f&&console.log("[Aviso] N\u00e3o existem mais resultados a partir da p\u00e1gina: "+currentPage)}else a.after(b);currentStatus=
true;k.remove()},error:function(){f&&console.log("[Error] Houve um erro na requisi\u00e7\u00e3o Ajax de uma nova p\u00e1gina.")}});currentPage++}}else return false})}};h.scrollToTop();h.infinitScroll();return b};